#!/usr/bin/env node

/**
 * Local Supabase Setup Script
 * Helps configure local development with your own Supabase instance
 */

const fs = require('fs');
const path = require('path');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

function question(prompt) {
  return new Promise((resolve) => {
    rl.question(prompt, resolve);
  });
}

async function setupLocalSupabase() {
  console.log('üöÄ Setting up local Supabase configuration...\n');

  // Check if .env.local already exists
  const envLocalPath = path.join(process.cwd(), '.env.local');
  const envLocalExists = fs.existsSync(envLocalPath);

  if (envLocalExists) {
    const overwrite = await question('‚ö†Ô∏è  .env.local already exists. Overwrite? (y/N): ');
    if (overwrite.toLowerCase() !== 'y' && overwrite.toLowerCase() !== 'yes') {
      console.log('‚ùå Setup cancelled.');
      rl.close();
      return;
    }
  }

  console.log('Please provide your Supabase project details:');
  console.log('(You can find these in your Supabase dashboard under Settings > API)\n');

  const supabaseUrl = await question('üìç Supabase URL: ');
  const supabaseAnonKey = await question('üîë Supabase Anon Key: ');

  if (!supabaseUrl || !supabaseAnonKey) {
    console.log('‚ùå Both URL and Anon Key are required.');
    rl.close();
    return;
  }

  // Create .env.local content
  const envContent = `# Local Development Environment Configuration
# Generated by setup-local-supabase.js

# Supabase Configuration
VITE_SUPABASE_URL=${supabaseUrl}
VITE_SUPABASE_PUBLISHABLE_KEY=${supabaseAnonKey}

# Local Development Supabase (Optional - Override)
VITE_LOCAL_SUPABASE_URL=${supabaseUrl}
VITE_LOCAL_SUPABASE_PUBLISHABLE_KEY=${supabaseAnonKey}

# Environment Configuration
VITE_USE_LOCAL_SUPABASE=true
`;

  try {
    fs.writeFileSync(envLocalPath, envContent);
    console.log('\n‚úÖ .env.local created successfully!');
    console.log('\nüìã Next steps:');
    console.log('1. Run your migrations on your local Supabase instance');
    console.log('2. Start the development server: npm run dev');
    console.log('3. The app will now use your local Supabase instance');
    console.log('\nüí° To switch back to Lovable Supabase:');
    console.log('   Set VITE_USE_LOCAL_SUPABASE=false in .env.local');
  } catch (error) {
    console.error('‚ùå Error creating .env.local:', error.message);
  }

  rl.close();
}

// Run the setup
setupLocalSupabase().catch(console.error);
